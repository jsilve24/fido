<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="fido">
<title>Non-linear models with fido::basset • fido</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Non-linear models with fido::basset">
<meta property="og:description" content="fido">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">fido</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/introduction-to-fido.html">Introduction to fido::Pibble</a>
    <a class="dropdown-item" href="../articles/non-linear-models.html">Non-linear models with fido::basset</a>
    <a class="dropdown-item" href="../articles/orthus.html">Joint Modeling  (e.g., Multiomics) with fido::Orthus</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jsilve24/fido/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Non-linear models with fido::basset</h1>
                        <h4 data-toc-skip class="author">Justin
Silverman</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jsilve24/fido/blob/HEAD/vignettes/non-linear-models.Rmd" class="external-link"><code>vignettes/non-linear-models.Rmd</code></a></small>
      <div class="d-none name"><code>non-linear-models.Rmd</code></div>
    </div>

    
    
<p>If you have not already done so, I would read through the
<em>pibble</em> vignette before this one.</p>
<div class="section level2">
<h2 id="fidobasset-the-model">fido::basset, the model<a class="anchor" aria-label="anchor" href="#fidobasset-the-model"></a>
</h2>
<p>fido can be used for non-linear modeling. Here we are going to go
through one such model which is based on multivariate Gaussian
processes. As Gaussian processes are a type of lazy learner, I have
named this model after a lazy dog: a Basset Hound. Hence this model is
called <em>basset</em>. The <em>basset</em> model can be written as
<span class="math display">\[
\begin{align}
Y_j &amp; \sim \text{Multinomial}\left(\pi_j \right)  \\
\pi_j &amp; = \phi^{-1}(\eta_j) \\
\eta &amp;\sim N(\Lambda[X], \Sigma, I_N) \\
\Lambda[X] &amp;\sim  \textsf{GP}(\Theta[X], \Sigma, \Gamma[X]) \\
\Sigma &amp;\sim W^{-1}(\Xi, \upsilon)
\end{align}
\]</span> where we now label quantities interpreted as function with
square brackets. In particular, we use the notation that <span class="math inline">\(\Lambda[X]\)</span> is a function that maps am
<span class="math inline">\(Q \times N\)</span> matrix of covariates
<span class="math inline">\(X\)</span> to a matrix <span class="math inline">\(\eta\)</span>. <span class="math inline">\(\Lambda\)</span> can be interpreted as a smooth
function that relates covariates <span class="math inline">\(X\)</span>
to composition <span class="math inline">\(\eta\)</span> in a
potentially non-linear manner. <span class="math inline">\(\Theta[X]\)</span> is the mean function evaluated
at <span class="math inline">\(X\)</span>, <span class="math inline">\(\Gamma[X]\)</span> is a covariance matrix (or gram
matrix) formed by evaluating a positive semi-definite kernel function
<span class="math inline">\(K\)</span> at each set of points <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, <em>i.e.</em>, <span class="math inline">\(\Gamma_{ij} = K(X_i, X_j)\)</span>. Many different
possible kernel functions makes this a very flexible and powerful
model.</p>
</div>
<div class="section level2">
<h2 id="non-linear-time-series-modeling">Non-linear time-series modeling<a class="anchor" aria-label="anchor" href="#non-linear-time-series-modeling"></a>
</h2>
<p>To demonstrate <em>basset</em> I am going to reanalyze the mallard<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;I have a long history of coming up with ridiculous names
for statistical models and software.&lt;/p&gt;"><sup>1</sup></a> dataset
from <span class="citation">Silverman et al. (2018)</span> which is
provided as a phyloseq object in <em>fido</em>. This dataset features 4
artificial gut vessels sampled both daily and hourly for 1 month with
many technical replicates.</p>
<p>To accord with prior analyses (and to make it easy to visualize
results) I am going to just analyze those bacterial families that are
frequently observed. Note: the full dataset (at the sequence variant
level without preprocessing) is available if you run
<code>data(mallard)</code>. For simplicity we will just look at samples
from vessel 1<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;In the future I may make a vignette discussing how we
can model all the vessels jointly using &lt;em&gt;basset&lt;/em&gt;. Note: it’s just
a different kernel function that also relates the covariance between
samples as a function of which vessel they were taken from.&lt;/p&gt;"><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jsilve24.github.io/fido/">fido</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">mallard_family</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Just take vessel 1</span></span>
<span><span class="va">sample.ids</span> <span class="op">&lt;-</span> <span class="va">mallard_family</span><span class="op">$</span><span class="va">sample_data</span><span class="op">[</span><span class="va">mallard_family</span><span class="op">$</span><span class="va">sample_data</span><span class="op">$</span><span class="va">Vessel</span> <span class="op">==</span> <span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="co"># Just take hourly samples</span></span>
<span><span class="va">sample.ids</span> <span class="op">&lt;-</span> <span class="va">sample.ids</span><span class="op">[</span><span class="op">(</span><span class="va">sample.ids</span><span class="op">$</span><span class="va">time</span> <span class="op">&gt;</span> <span class="st">"2015-11-20 15:00:00 UTC"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">sample.ids</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;</span> <span class="st">"2015-11-25 16:00:00 UTC"</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Subsetting the sample data and OTU data</span></span>
<span><span class="va">subset.sample_data</span> <span class="op">&lt;-</span> <span class="va">mallard_family</span><span class="op">$</span><span class="va">sample_data</span><span class="op">[</span><span class="va">mallard_family</span><span class="op">$</span><span class="va">sample_data</span><span class="op">$</span><span class="va">X.SampleID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample.ids</span><span class="op">$</span><span class="va">X.SampleID</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">subset.otu_table</span> <span class="op">&lt;-</span> <span class="va">mallard_family</span><span class="op">$</span><span class="va">otu_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mallard_family</span><span class="op">$</span><span class="va">otu_table</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample.ids</span><span class="op">$</span><span class="va">X.SampleID</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Order samples - to make plotting easy later</span></span>
<span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">subset.sample_data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="va">subset.otu_table</span> <span class="op">&lt;-</span> <span class="va">subset.otu_table</span><span class="op">[</span><span class="va">o</span>,<span class="op">]</span></span>
<span><span class="va">subset.sample_data</span> <span class="op">&lt;-</span> <span class="va">subset.sample_data</span><span class="op">[</span><span class="va">o</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Extract Data / dimensions from Phyloseq object</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu">as</span><span class="op">(</span><span class="va">subset.otu_table</span>, <span class="st">"matrix"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">subset.sample_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># X in hours</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">subset.sample_data</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">(</span><span class="va">X</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">3600</span><span class="op">)</span></span></code></pre></div>
<p>The function <em>basset</em> is a wrapper around some <em>fido</em>
internals that make fitting the above model easy. <em>basset</em> is
patterned after the function <em>pibble</em> but requires that
<code>Theta</code> and <code>Gamma</code> be given as matrix functions
rather than as matrices. That is <code>Theta</code> must be a function
that given <code>X</code> outputs a <span class="math inline">\(D-1
\times N\)</span> matrix (just like you would give to <em>pibble</em>)
and <code>Gamma</code> must be a function that given <code>X</code>
outputs a <span class="math inline">\(N \times N\)</span> covariance
matrix (e.g., covariance over the samples). There are a few kernel
functions that meet the requirements for <code>Gamma</code> in
<em>fido</em> already. Here we will use a Squared Exponential (SE)
kernel for <code>Gamma</code> and will set <code>Theta</code> to be the
zero function. The SE kernel will give us non-linear smoothing of the
observed time-series.</p>
<p><em>Important Note:</em> Currently, <code>Theta</code> must output a
matrix represented in the default coordinate system (<span class="math inline">\(ALR_D\)</span>). This may be generalized in the
future.</p>
<p>Here we will just specify the Kernel parameters manually, more
generally these parameters can be chosen by cross-validation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify Priors</span></span>
<span><span class="va">Gamma</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu"><a href="../reference/kernels.html">SE</a></span><span class="op">(</span><span class="va">X</span>, sigma<span class="op">=</span><span class="fl">5</span>, rho<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="co"># Create partial function </span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">upsilon</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">+</span><span class="fl">3</span></span>
<span><span class="va">Xi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Xi</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Now fit the model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fido</span><span class="fu">::</span><span class="fu"><a href="../reference/basset_fit.html">basset</a></span><span class="op">(</span><span class="va">Y</span>, <span class="va">X</span>, <span class="va">upsilon</span>, <span class="va">Theta</span>, <span class="va">Gamma</span>, <span class="va">Xi</span><span class="op">)</span></span>
<span><span class="co">#&gt; No rows of X were specified. Using all rows...</span></span></code></pre></div>
<p>It turns out that <em>basset</em> is really just creating a
<em>pibblefit</em> object that is a little special because it represents
a posterior over non-linear functions. The benefit of this is that many
of the methods available for <em>pibblefit</em> objects work for
<em>bassetfit</em> objects. For example, we can use the same
transformation methods:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit.clr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fido_transforms.html">to_clr</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot Sigma in CLR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit.clr</span>, par<span class="op">=</span><span class="st">"Sigma"</span>, focus.coord<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"clr_seq_6"</span>, <span class="st">"clr_seq_5"</span>, <span class="st">"clr_seq_2"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="non-linear-models_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<p>Really <em>basset</em> shows its power when you use it to smooth.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># predict not just missing days but also forecast into future</span></span>
<span><span class="va">X_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit.clr</span>, <span class="va">X_predict</span>, jitter<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span></code></pre></div>
<p>Now I am going to create a visual that shows the observed data in CLR
coordinates (to do that I will need to add a pseudo-count) along with
the smoothed estimates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">family_names</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="va">mallard_family</span><span class="op">$</span><span class="va">tax_table</span><span class="op">$</span><span class="va">Family</span>, <span class="st">"vector"</span><span class="op">)</span></span>
<span><span class="va">Y_clr_tidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clr_array.html">clr_array</a></span><span class="op">(</span><span class="va">Y</span><span class="op">+</span><span class="fl">0.65</span>, parts <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/gather_array.html">gather_array</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">coord</span>, <span class="va">sample</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span>,<span class="va">sample</span><span class="op">]</span>,</span>
<span>         coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CLR("</span>, <span class="va">family_names</span><span class="op">[</span><span class="va">coord</span><span class="op">]</span>,<span class="st">")"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predicted_tidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gather_array.html">gather_array</a></span><span class="op">(</span><span class="va">predicted</span>, <span class="va">val</span>, <span class="va">coord</span>, <span class="va">sample</span>, <span class="va">iter</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">X_predict</span><span class="op">[</span><span class="fl">1</span>,<span class="va">sample</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">coord</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarise_posterior.html">summarise_posterior</a></span><span class="op">(</span><span class="va">val</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CLR("</span>, <span class="va">family_names</span><span class="op">[</span><span class="va">coord</span><span class="op">]</span>,<span class="st">")"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">predicted_tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y<span class="op">=</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">p2.5</span>, ymax<span class="op">=</span><span class="va">p97.5</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"darkgrey"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">p25</span>, ymax<span class="op">=</span><span class="va">p75</span><span class="op">)</span>, fill<span class="op">=</span><span class="st">"darkgrey"</span>, alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Y_clr_tidy</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">coord</span>, scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="non-linear-models_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="updated-functionality-additive-gaussian-processes">Updated Functionality: Additive Gaussian Processes<a class="anchor" aria-label="anchor" href="#updated-functionality-additive-gaussian-processes"></a>
</h2>
<p><em>Michelle Nixon</em></p>
<p>Starting with <em>fido</em> version 1.1.0, the <em>basset</em> model
has been updated. The new model is a more flexible extension of the old
model as it allows <span class="math inline">\(\eta\)</span> to be
modeled as an additive Gaussian process model:</p>
<p><span class="math display">\[\begin{align*}
    Y_j &amp;\sim \mathrm{Multinomial}(\pi_j)\\
    \pi_j &amp;= \phi(\eta_j)\\
    \eta_j &amp;\sim N(\Lambda(X), \Sigma, I)\\
    \Lambda(X) &amp;= \Lambda_1 X + \Lambda_2(X) + ... + \Lambda_p(X)\\
    \Lambda_1 &amp;\sim N(\Theta_1, \Sigma, \Gamma_1)\\
    \Lambda_2(X) &amp;\sim GP(\Theta_2(X), \Sigma, \Gamma_2(X))\\
    &amp; \cdots\\
    \Lambda_p(X) &amp;\sim GP(\Theta_p(X), \Sigma, \Gamma_p(X))\\
    \Sigma &amp;\sim IW(\Xi, \upsilon).
\end{align*}\]</span></p>
<p>There is a great deal of flexibility in how <span class="math inline">\(\Theta_i(X)\)</span> and <span class="math inline">\(\Gamma_i(X)\)</span> can be specified for <span class="math inline">\(i = 1,...,p\)</span>. To invoke the additive
Gaussian process, the inputs <em>Theta</em> and <em>Gamma</em> can now
be a list of length <span class="math inline">\(p\)</span> with each
element of both lists corresponding to the prior specification for a
given additive component. The elements of the list can either be
functions over the correct dimensions (see documentation) or an
(optional) matrix of correct size. If the matrix is used for component
<span class="math inline">\(i\)</span>, then a linear model is fit for
that component, and <span class="math inline">\(\Lambda_i(X)\)</span>
returns estimated parameters similar to the <em>fido</em> model. If a
function is used for component <span class="math inline">\(i\)</span>,
then that component works similarly to the old <em>basset</em> model in
both input and returned results. <strong>Note:</strong> If the <span class="math inline">\(i^{th}\)</span> list item for <em>Theta</em> is a
function, then the <span class="math inline">\(i^{th}\)</span> list item
for <em>Gamma</em> must also be a function. If the <span class="math inline">\(i^{th}\)</span> list item for <em>Theta</em> is a
matrix, then the <span class="math inline">\(i^{th}\)</span> list item
for <em>Gamma</em> must also be a matrix.</p>
<p>Now, a simple simulation study to show how the updated functionality
works. First, we are going to simulate our data. Here, we will simulate
three taxa (<span class="math inline">\(D=3\)</span>) over 100
observations (<span class="math inline">\(N=100\)</span>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jsilve24.github.io/fido/">fido</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://CRAN.R-project.org/package=MCMCpack" class="external-link">MCMCpack</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LaplacesDemonR/LaplacesDemon" class="external-link">LaplacesDemon</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># number of taxa</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co">#number of observation</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">)</span> <span class="co"># specifying the values of X</span></span></code></pre></div>
<p>We are going to simulate our data such that <span class="math inline">\(\Lambda(X) = \Lambda_1(X) + \Lambda_2(X)\)</span>.
The first component will be using a radial basis function kernel. The
second component will be using a linear kernel.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># RBF kernel function</span></span>
<span><span class="va">rbf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">l</span>,<span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">x</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, <span class="va">sigma</span>,<span class="va">l</span><span class="op">)</span><span class="op">{</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>, sigma <span class="op">=</span> <span class="va">sigma</span>, l <span class="op">=</span> <span class="va">l</span><span class="op">)</span></span>
<span>  <span class="va">identity_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">K</span>  <span class="op">&lt;-</span>  <span class="va">K</span>  <span class="op">+</span> <span class="fl">1e-8</span> <span class="op">*</span> <span class="va">identity_matrix</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Linear kernel function</span></span>
<span><span class="va">linear</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">sigma</span>,<span class="va">c</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">x</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, <span class="va">sigma</span>,<span class="va">c</span><span class="op">)</span><span class="op">{</span> <span class="op">(</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">c</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">y</span><span class="op">-</span><span class="va">c</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>, sigma <span class="op">=</span> <span class="va">sigma</span>, c<span class="op">=</span><span class="va">c</span><span class="op">)</span></span>
<span>  <span class="va">identity_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">K</span>  <span class="op">&lt;-</span>  <span class="va">K</span>  <span class="op">+</span> <span class="fl">1e-8</span> <span class="op">*</span> <span class="va">identity_matrix</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>First, we will simulate <span class="math inline">\(\Sigma\)</span>,
then <span class="math inline">\(\Lambda_1(X)\)</span> and <span class="math inline">\(\Lambda_2(X)\)</span> (and thus <span class="math inline">\(\Lambda(X)\)</span>). Then, we will simulate <span class="math inline">\(\eta\)</span>, transform to proportions, and,
finally, simulate <span class="math inline">\(Y\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Step 1: Sigma ~ IW(upsilon,Xi)</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/LaplacesDemon/man/dist.Inverse.Wishart.html" class="external-link">rinvwishart</a></span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step 2a: Lambda_1 ~ GP(0,Sigma,K)</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fu">rbf</span><span class="op">(</span><span class="va">X</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,nrow <span class="op">=</span> <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">l1</span> <span class="op">&lt;-</span> <span class="va">Theta</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">x</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step 2b: Lambda_2 ~ GP(0, Sigma, K2)</span></span>
<span><span class="va">K2</span> <span class="op">&lt;-</span> <span class="fu">linear</span><span class="op">(</span><span class="va">X</span>,<span class="fl">.1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,nrow <span class="op">=</span> <span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">l2</span> <span class="op">&lt;-</span> <span class="va">Theta</span><span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">x</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">K2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">l</span> <span class="op">&lt;-</span> <span class="va">l1</span> <span class="op">+</span> <span class="va">l2</span></span>
<span></span>
<span><span class="co">## Step 3: eta ~ N(Lambda,Sigma, I)</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="op">(</span><span class="va">D</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,nrow <span class="op">=</span> <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">l</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">eta</span></span>
<span></span>
<span><span class="co">## Step 4: transform to proportions</span></span>
<span><span class="va">pai</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="../reference/alrInv.html">alrInv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step 5: Simulate Y.</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">D</span>, <span class="va">N</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="va">Y</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5000</span>, prob <span class="op">=</span> <span class="va">pai</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Phew! Now, to analyze the data. First, we want to specify our priors
for <span class="math inline">\(\Gamma_1(X)\)</span> and <span class="math inline">\(\Gamma_2(X)\)</span>. Since we know how the data
were simulated, we will use the ground truth as our priors:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rbf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">l</span>,<span class="va">sigma</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span>  <span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">x</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, <span class="va">sigma</span>,<span class="va">l</span><span class="op">)</span><span class="op">{</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">l</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>, sigma <span class="op">=</span> <span class="va">sigma</span>, l <span class="op">=</span> <span class="va">l</span><span class="op">)</span></span>
<span>  <span class="va">identity_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">K</span>  <span class="op">&lt;-</span>  <span class="va">K</span>  <span class="op">+</span> <span class="fl">1e-8</span> <span class="op">*</span> <span class="va">identity_matrix</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Linear kernel function for Gaussian process</span></span>
<span><span class="va">linear</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">sigma</span>,<span class="va">c</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span>  <span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">x</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, <span class="va">sigma</span>,<span class="va">c</span><span class="op">)</span><span class="op">{</span> <span class="op">(</span><span class="va">sigma</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">c</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">y</span><span class="op">-</span><span class="va">c</span><span class="op">)</span><span class="op">)</span><span class="op">}</span>, sigma <span class="op">=</span> <span class="va">sigma</span>, c<span class="op">=</span><span class="va">c</span><span class="op">)</span></span>
<span>  <span class="va">identity_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">K</span>  <span class="op">&lt;-</span>  <span class="va">K</span>  <span class="op">+</span> <span class="fl">1e-8</span> <span class="op">*</span> <span class="va">identity_matrix</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu">rbf</span><span class="op">(</span><span class="va">X</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu">linear</span><span class="op">(</span><span class="va">X</span>,<span class="fl">.1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we need to specify our prior for <span class="math inline">\(\Theta_1(X)\)</span> and <span class="math inline">\(\Theta_2(X)\)</span>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And, finally, we can fit the model:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mmX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">X</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basset_fit.html">basset</a></span><span class="op">(</span><span class="va">Y</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mmX</span><span class="op">)</span>, Theta <span class="op">=</span> <span class="va">Theta</span>, Gamma <span class="op">=</span> <span class="va">Gamma</span><span class="op">)</span></span>
<span><span class="co">#&gt; No rows of X were specified. Using all rows...</span></span></code></pre></div>
<p>Now, let’s look at the results. You’ll notice that the parameter
objects for <span class="math inline">\(\Lambda\)</span> is now a list.
It behaves as you largely would expect: the <span class="math inline">\(i^{th}\)</span> element of the list for
<em>Lambda</em> corresponds to the <span class="math inline">\(i^{th}\)</span> component as specified by
<em>Theta</em> and <em>Gamma</em>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="va">mod</span><span class="op">$</span><span class="va">Lambda</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span></code></pre></div>
<p>The model object should largely work as it has before. For example,
we can find predictions:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## predictions</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## summarizing predictions over posterior samples</span></span>
<span><span class="va">summary_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">preds</span>,MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<p>And, finally, we can plot the predictions:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## plotting</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"points"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">eta</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">summary_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, <span class="st">"group"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Truth"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">eta</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Predicted"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">summary_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Index"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Index</span>, y<span class="op">=</span> <span class="va">points</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Eta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="non-linear-models_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<p>Note that since the second component was linear, we could have
specified the priors using matrices as well. This might be more helpful
if, for example, the estimated individual coefficients for the linear
terms are of interest.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mmX</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">D</span><span class="op">-</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">mmX</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="fu">rbf</span><span class="op">(</span><span class="va">X</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mmX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">X</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/basset_fit.html">basset</a></span><span class="op">(</span><span class="va">Y</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">mmX</span><span class="op">)</span>, Theta <span class="op">=</span> <span class="va">Theta</span>, Gamma <span class="op">=</span> <span class="va">Gamma</span><span class="op">)</span></span>
<span><span class="co">#&gt; No rows of X were specified. Using all rows...</span></span></code></pre></div>
<p>Finally, predicting and plotting:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## predictions</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## summarizing predictions over posterior samples</span></span>
<span><span class="va">summary_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">preds</span>,MARGIN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## plotting</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"points"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">eta</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">summary_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, <span class="st">"group"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Truth"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">eta</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"Predicted"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">summary_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="st">"Index"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Index</span>, y<span class="op">=</span> <span class="va">points</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Eta"</span><span class="op">)</span></span></code></pre></div>
<p><img src="non-linear-models_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<p>An updated vignette will be available soon.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-silverman2018" class="csl-entry">
Silverman, Justin D, Heather Durand, Rachael J Bloom, Sayan Mukherjee,
and Lawrence A David. 2018. <span>“Dynamic Linear Models Guide Design
and Analysis of Microbiota Studies Within Artificial Human Guts.”</span>
<em>bioRxiv</em>. <a href="https://doi.org/10.1101/306597" class="external-link">https://doi.org/10.1101/306597</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://www.justin-silverman.com/" class="external-link">Justin Silverman</a>, Michelle Nixon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
